@using NPAManagement.ValidationFilters;
@model NPAManagement.Models.FollowUpDetailForAuctionNotice
@if (this.ViewContext.FormContext == null)
{
    this.ViewContext.FormContext = new FormContext();
}
@{string idValueToAttach = $"AuctionNotice_{new Random().Next(1000, 9999)}{new Random().Next(1000, 9999)}{new Random().Next(10000, 99999)}{new Random().Next(1000, 9999)}";}
<div id="followUpDetailType_@idValueToAttach">
    <br />
    @Html.HiddenFor(model => model.EnableControls)
    @if (Model.EnableControls == false)
    {
        @Html.HiddenFor(model => model.DateOfRevaluationForAuction)
        @Html.HiddenFor(model => model.RevaluatedFMVOfCollateralForAuction)
        @Html.HiddenFor(model => model.DateOfAuctionNotice)
        @Html.HiddenFor(model => model.AuctionNoticeTypeId)
        @Html.HiddenFor(model => model.AuctionNewspaperName)
        @Html.HiddenFor(model => model.AuctionResponseOfBorrower)
        @Html.HiddenFor(model => model.AuctionNextActionToBeTaken)
        @Html.HiddenFor(model => model.AuctionDueDateOfNextAction)
        @Html.HiddenFor(model => model.AuctionRemarks)
    }
    @Html.HiddenFor(model => model.FollowUpMainId, new { @class = "form-control", @data_Model = "FollowUpMainId", @id = "FollowUpMainId" + (idValueToAttach) })
    @Html.HiddenFor(model => model.FollowUpTypeId, new { @class = "form-control", @data_Model = "FollowUpTypeId", @id = "FollowUpTypeId" + (idValueToAttach) })
    @Html.HiddenFor(model => model.FollowUpById, new { @class = "form-control", @data_Model = "FollowUpById", @id = "FollowUpById" + (idValueToAttach) })
    <div class="card">
        <div class="card-header" data-toggle="collapse" data-target="#collapseAuctionNotice_@idValueToAttach" aria-expanded="true" aria-controls="collapseAuctionNotice_@idValueToAttach">
            <h3>
                Auction Notice
            </h3>
        </div>
        <div class="collapse show" id="collapseAuctionNotice_@idValueToAttach">
            <div class="card-body">
                <div class="form-row">
                    @Html.LabelFor(model => model.DateOfRevaluationForAuction, htmlAttributes: new { @class = "control-label col-md-3 required" })
                    <div class="col-md-3">
                        @Html.EditorFor(model => model.DateOfRevaluationForAuction, new { htmlAttributes = new { @class = "form-control date", @readOnly = "readOnly", @data_Model = "DateOfRevaluationForAuction", @id = "DateOfRevaluationForAuction" + (idValueToAttach) }.DisabledIf(Model.EnableControls == false) })
                        @Html.ValidationMessageFor(model => model.DateOfRevaluationForAuction, "", new { @class = "text-danger" })
                    </div>
                    @Html.LabelFor(model => model.RevaluatedFMVOfCollateralForAuction, htmlAttributes: new { @class = "control-label col-md-3 required" })
                    <div class="col-md-3">
                        @Html.EditorFor(model => model.RevaluatedFMVOfCollateralForAuction, new { htmlAttributes = new { @class = "form-control decimalType", @data_Model = "RevaluatedFMVOfCollateralForAuction" }.DisabledIf(Model.EnableControls == false) })
                        @Html.ValidationMessageFor(model => model.RevaluatedFMVOfCollateralForAuction, "", new { @class = "text-danger" })
                    </div>
                </div>
                <hr />
                <div class="form-row">
                    @Html.LabelFor(model => model.DateOfAuctionNotice, htmlAttributes: new { @class = "control-label col-md-3 required" })
                    <div class="col-md-3">
                        @Html.EditorFor(model => model.DateOfAuctionNotice, new { htmlAttributes = new { @class = "form-control date", @readOnly = "readOnly", @data_Model = "DateOfAuctionNotice", @id = "DateOfAuctionNotice" + (idValueToAttach) }.DisabledIf(Model.EnableControls == false) })
                        @Html.ValidationMessageFor(model => model.DateOfAuctionNotice, "", new { @class = "text-danger" })
                    </div>
                    @Html.LabelFor(model => model.AuctionNoticeTypeId, htmlAttributes: new { @class = "control-label col-md-3 required" })
                    <div class="col-md-3">
                        @Html.DropDownListFor(m => m.AuctionNoticeTypeId, (IEnumerable<SelectListItem>)ViewData["AuctionNoticeTypes"], "-- Please Select --", new { @class = "form-control", @data_Model = "AuctionNoticeTypeId" }.DisabledIf(Model.EnableControls == false))
                        @Html.ValidationMessageFor(m => m.AuctionNoticeTypeId, "", new { @class = "text-danger" })
                    </div>
                </div>
                <hr />
                <div class="form-row">
                    @Html.LabelFor(model => model.AuctionNewspaperName, htmlAttributes: new { @class = "control-label col-md-3 required" })
                    <div class="col-md-3">
                        @Html.EditorFor(model => model.AuctionNewspaperName, new { htmlAttributes = new { @class = "form-control", @data_Model = "AuctionNewspaperName" }.DisabledIf(Model.EnableControls == false) })
                        @Html.ValidationMessageFor(model => model.AuctionNewspaperName, "", new { @class = "text-danger" })
                    </div>
                    @Html.LabelFor(model => model.AuctionResponseOfBorrower, htmlAttributes: new { @class = "control-label col-md-3 required" })
                    <div class="col-md-3">
                        @Html.EditorFor(model => model.AuctionResponseOfBorrower, new { htmlAttributes = new { @class = "form-control", @data_Model = "AuctionResponseOfBorrower" }.DisabledIf(Model.EnableControls == false) })
                        @Html.ValidationMessageFor(model => model.AuctionResponseOfBorrower, "", new { @class = "text-danger" })
                    </div>
                </div>
                <hr />
                <div class="form-row">
                    @Html.LabelFor(model => model.AuctionNextActionToBeTaken, htmlAttributes: new { @class = "control-label col-md-3 required" })
                    <div class="col-md-3">
                        @Html.EditorFor(model => model.AuctionNextActionToBeTaken, new { htmlAttributes = new { @class = "form-control", @data_Model = "AuctionNextActionToBeTaken" }.DisabledIf(Model.EnableControls == false) })
                        @Html.ValidationMessageFor(model => model.AuctionNextActionToBeTaken, "", new { @class = "text-danger" })
                    </div>
                    @Html.LabelFor(model => model.AuctionDueDateOfNextAction, htmlAttributes: new { @class = "control-label col-md-3 required" })
                    <div class="col-md-3">
                        @Html.EditorFor(model => model.AuctionDueDateOfNextAction, new { htmlAttributes = new { @class = "form-control date", @readOnly = "readOnly", @data_Model = "AuctionDueDateOfNextAction", @id = "AuctionDueDateOfNextAction" + (idValueToAttach) }.DisabledIf(Model.EnableControls == false) })
                        @Html.ValidationMessageFor(model => model.AuctionDueDateOfNextAction, "", new { @class = "text-danger" })
                    </div>
                </div>
                <hr />
                <div class="form-row">
                    @Html.LabelFor(model => model.AuctionRemarks, htmlAttributes: new { @class = "control-label col-md-3 required" })
                    <div class="col-md-3">
                        @Html.EditorFor(model => model.AuctionRemarks, new { htmlAttributes = new { @class = "form-control", @data_Model = "AuctionRemarks" }.DisabledIf(Model.EnableControls == false) })
                        @Html.ValidationMessageFor(model => model.AuctionRemarks, "", new { @class = "text-danger" })
                    </div>
                    @Html.LabelFor(model => model.ScanCopyOfActionTakenPath, htmlAttributes: new { @class = "control-label col-md-3 required" })
                    <div class="col-md-3">
                        @Html.TextBoxFor(model => model.ScanCopyOfActionTakenFile, new { @type = "file", @class = "form-control-file upload-file-validated", @data_Model = "ScanCopyOfActionTakenFile", @id = "ScanCopyOfActionTakenFile" + (idValueToAttach) }.DisabledIf(Model.EnableControls == false))
                        @Html.HiddenFor(model => model.ScanCopyOfActionTakenFileType, new { @class = "scanCopyOfActionTakenFileType", @data_Model = "ScanCopyOfActionTakenFileType", @id = "ScanCopyOfActionTakenFileType" + (idValueToAttach) })
                    </div>
                </div>
                <div class="form-row">
                    @{
                        DirectoryInfo di = new DirectoryInfo(HttpContext.Current.Server.MapPath($"~/UploadedFiles/NPAID-{Model.NPAManagementId}/FLWTYPE-{Model.FollowUpById}/"));
                        if (Directory.Exists(HttpContext.Current.Server.MapPath($"~/UploadedFiles/NPAID-{Model.NPAManagementId}/FLWTYPE-{Model.FollowUpById}/")))
                        {
                            foreach (DirectoryInfo dir in di.GetDirectories())
                            {
                                if (Model.FollowUpMainId.ToString() == dir.Name)
                                {
                                    foreach (FileInfo file in dir.GetFiles())
                                    {
                                        <div class="offset-9 col-md-3">
                                            <a href="../@(file.FullName.Replace(HttpContext.Current.Request.PhysicalApplicationPath, String.Empty))" style="color:green" target="_blank">View Uploaded File</a>
                                        </div>
                                    }
                                }
                            }
                        }
                    }
                </div>
            </div>
        </div>
    </div>
    <br />
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
<script type="text/javascript">
    $(document).ready(function () {
        $("#followUpDetailType_@(idValueToAttach) .date").datepicker({
            dateFormat: 'yy/mm/dd',
            changeMonth: true,
            changeYear: true
        });

        $('.decimalType').toArray().forEach(function (field) {
            new Cleave(field, {
                numeral: true,
                numeralThousandsGroupStyle: 'thousand'
            });
        });

        $('.dvFollowUpDetailGeneral').each(function () {
            var inputCtrl = $(this).find("input[type=file]")[0];
            var reader = new FileReader();
            if (inputCtrl !== undefined) {
                inputCtrl.addEventListener('change', (e) => {
                    reader.readAsDataURL(e.target.files[0]);
                    reader.onloadend = (evt) => {
                        if (evt.target.readyState === FileReader.DONE) {
                            if ($(e.target).val() !== '') {
                                $(e.target).attr("bytearr", reader.result.replace('data:', '').replace(/^.+,/, ''));
                                var inputFileName = $(this).find(".scanCopyOfActionTakenFileType")[0];
                                $(inputFileName).val($(inputCtrl).val().split('.').pop());
                            }
                        }
                    }
                });
            }
        });

        //Start//File Size and Extention validation
        $(".upload-file-validated").change(function () {
            if (fileExtValidate(this)) { // file extension validation function
                if (fileSizeValidate(this)) { // file size validation function

                }
            }
        });

        // function for  validate file extension
        var validExt = ".jpeg, .jpg, .pdf";
        function fileExtValidate(fdata) {
            var filePath = fdata.value;
            var getFileExt = filePath.substring(filePath.lastIndexOf('.') + 1).toLowerCase();
            var pos = validExt.indexOf(getFileExt);
            if (pos < 0) {
                $(fdata).val('');
                $(fdata).attr("bytearr", "");
                alert("This file is not allowed, please upload valid file.");
                return false;
            } else {
                return true;
            }
        }
        //function for validate file size 
        var maxSize = '1024';
        function fileSizeValidate(fdata) {
            if (fdata.files && fdata.files[0]) {
                var fsize = fdata.files[0].size / 1024;
                if (fsize > maxSize) {
                    $(fdata).val('');
                    $(fdata).attr("bytearr", "");
                    alert('Maximum file size exceed, This file size is: ' + fsize + "KB");
                    return false;
                } else {
                    return true;
                }
            }
        }
    //End//File Size and Extention validation
    });
</script>